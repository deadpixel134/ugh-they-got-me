#SingleInstance force; 스크린샷 관련#Include Gdip_all.ahk; https://github.com/cocobelgica/AutoHotkey-JSON; 자동 업데이트를 위한 스크립트; 전체 사이클에 27분 예상#Include JSON.ahk#Include Jxon.ahkSetWorkingDir %A_ScriptDir%;게임과 상호작용하기 위한 관리자 권한 요청 스크립트full_command_line := DllCall("GetCommandLine", "str")if not (A_IsAdmin or RegExMatch(full_command_line, " /restart(?!\S)")){    try    {        if A_IsCompiled            Run *RunAs "%A_ScriptFullPath%" /restart        else            Run *RunAs "%A_AhkPath%" /restart "%A_ScriptFullPath%"    }    ExitApp}GitVersion(User, Repo) {    url := "https://api.github.com/repos/" User "/" Repo "/releases/latest"    whr := ComObjCreate("WinHttp.WinHttpRequest.5.1")    whr.Open("GET", url, false), whr.Send()    RegExMatch(whr.ResponseText, "_name\W+\K[^""]+", tag)    return tag}GitName(User, Repo) {    url := "https://api.github.com/repos/" User "/" Repo "/releases/latest"    whr := ComObjCreate("WinHttp.WinHttpRequest.5.1")    whr.Open("GET", url, false), whr.Send()    RegExMatch(whr.ResponseText, "[""]name[""]:\W+.*draft", Name)    return Name};	상남자특) 하드코딩함Name:= % GitName("deadpixel134", "ugh-they-got-me")Namefilter := SubStr(Name,9,200)Namefilter := SubStr(Namefilter,1,-8)Version := % GitVersion("deadpixel134", "ugh-they-got-me"); !!!!!!!!!!!!!!!!제발 Version은 최신 릴리즈 태그 + 1이야. 업뎃할때 좀 잊어버리지 좀 마라!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!if Version >= 12{	; UrlDownloadToFile, https://github.com/deadpixel134/ugh-they-got-me/releases/latest/download/package.zip, %A_WorkingDir%\package.zip	Msgbox,4, 업데이트가 존재합니다!, 업데이트가 발견되었습니다. 깃허브 페이지를 열고 업데이트를 확인하시겠어요?`n`n간단 업데이트 내용:`n`n%Namefilter%	ifMsgBox, Yes	{	Run https://github.com/deadpixel134/ugh-they-got-me/releases/latest/	exitapp	}};GUI 설정gui_title := "Map gacha"FileCreateDir, logFileCreateDir, screenshotFormatTime date,, yyyy-MM-ddFormatTime time,, HH:mm:ssGui Show, w550 h280, %gui_title%Gui Color, White, WhiteGui Add, Text, w360 h15 +Center, %date% %time%에 실행됨Gui Add, Text, w360 h18 +Center vA, 준비Gui Add, Text, w360 h18 +Center vB, 0 회Gui Add, Text, x20 y140 w100 h18 +Center, 시작 번호Gui Add, Edit, x110 y138 w50 h18 vstart Number, 0Gui Add, Text, x220 y140 w100 h40 +Center, 끝 번호Gui Add, Edit, x310 y138 w50 h18 voffset Number, 50Gui Add, Button, x130 y245 w120 h30, 종료Gui Add, GroupBox, x10 y170 w220 h68, 자동 종료 트리거 설정Gui Add, CheckBox, x20 y210 vError_Shutdown, 진행 중 에러 발생시 트리거`nGui Add, CheckBox, x20 y190 vFinish_Shutdown, 지정된 만큼 진행이 끝나면 트리거`nGui Add, GroupBox, x250 y170 w100 h68, 자동 종료 레벨 설정Gui Add, CheckBox, x260 y190 vGame_Shutdown, 게임 종료`nGui Add, CheckBox, x260 y210 vSystem_shutdown, 시스템 종료`nGui Add, CheckBox, x90 y100 w240 h20 vSound, 시작 완료 효과음 ON/OFF (F1 Only)Gui Add, GroupBox, x380 y20 w160 h180, 단축키 ON/OFFGui Add, CheckBox, x390 y40 vkey_F1, F1`n(새로운 게임 시작)Gui Add, CheckBox, x390 y80 vKey_F2, F2`n(게임 저장 후 나가기)Gui Add, CheckBox, x390 y120 vKey_Ctrl_F1, Ctrl+F1`n(세이브 대량 생성)Gui Add, CheckBox, x390 y160 vKey_Ctrl_F2, Ctrl+F2`n(매크로 재시작)Gui, Add, Link, x360 y220 , <a href="https://github.com/deadpixel134/ugh-they-got-me/releases/">깃허브 링크</a>Gui, Add, Link, x360 y240 , <a href="%A_ScriptDir%\screenshot">클릭시 스크린샷 폴더로 이동</a>Gui, Add, Link, x360 y260 , <a href="%userprofile%\Documents\My Games\They Are Billions\Saves">클릭시 데아빌 세이브 폴더로 이동</a>guicontrol, , key_F1, 1guicontrol, , key_F2, 1guicontrol, , Key_Ctrl_F1, 1guicontrol, , Key_Ctrl_F2, 1FormatTime, CurrentDateTime,, yyyy-MM-dd HH-mmlog_dir = log\%CurrentDateTime% log.txtguicontrol, , Sound, 1current:=0playtime:=0ReturnF1::{GuiControlGet,keyF1,,key_F1,if keyF1=1{   Gui,Submit,nohide	;GUI의 값을 받아옵니다.   GuiControl,,A,시작		MouseClick, Left, 1657, 469,1   sleep,150		MouseClick, Left, 1637, 538,1   sleep,150		MouseClick, Left, 1125, 681,1   sleep,200		MouseClick, Left, 1125, 681,1   sleep,300		MouseClick, Left, 1269, 924,1   sleep,10000   SetNumLockState , Off   	load=0		GuiControl,,A,로딩 대기			while load<1	{	;게임 시작 후 우하단 솔져 초상화 찾기	PixelSearch, ,, 1856, 810, 1878, 830, 0xE46C49, 10, Fast RGB	;픽셀 서치를 시작할 지점 X Y 좌표 - 끝 지점 X Y 좌표, RGB값, 오차값, Fast(빠른) RGB(형식)		 if((ErrorLevel = 0))			{	;게임 시작 후 우하단 솔져 초상화 우측의 숫자 찾기	PixelSearch, ,, 1888, 810, 1902, 830, 0xE3D572, 10, Fast RGB	;픽셀 서치를 시작할 지점 X Y 좌표 - 끝 지점 X Y 좌표, RGB값, 오차값, Fast(빠른) RGB(형식)		 if((ErrorLevel = 0))			{				load++				Send {Pgdn Down} ;축소용 페이지 다운 누르기				sleep,200				send {F4} ;격자맵				sleep,100				Send {Space} ;일시정지				sleep,100				Send {NumLock Down} ;넘락 누르기				sleep,50				Send {numpad7 Down} ;넘패드 7번 누르기				sleep,50				Send {NumLock Up} ;넘락 떼기				sleep,450				Send {Pgdn Up} ;페이지 다운 떼기				GuiControl,,A,시작 완료			}			else			{			sleep, 500			}}	}		if (Sound=1)	{    Random,select,1,37	SoundPlay, %select%.mp3	}	GuiControl,,A,소리 재생 완료   sleep,100}}return      F2::{GuiControlGet,keyF2,,Key_F2,if keyF2=1{   {   GuiControl,,A,게임 나가기   send {Esc}   sleep,200		MouseClick, Left, 1598, 610,1      playtime := playtime + 1      GuiControl, , B, %playtime% 회   }   GuiControl,,A,게임 나가기 완료   }}return^F1::{GuiControlGet,keyCtrlF1,,Key_Ctrl_F1,if keyCtrlF1=1{GuiControlGet,current,,start,GuiControlGet,tries,,offset,GuiControlGet,Game_Shutdown,,Game_Shutdown,GuiControlGet,System_shutdown,,System_shutdown,GuiControlGet,Error_Shutdown,,Error_Shutdown,GuiControlGet,Finish_Shutdown,,Finish_Shutdown,tries:=tries+1while current<tries{	WinActivate They Are Billions   GuiControl,,A,CTRL+F1 입력됨   	load=0	i=0	while load<1	{	WinActivate They Are Billions		PixelSearch, ,, 1620, 200, 1650, 240, 0xD5AB60, 10, Fast RGB	;픽셀 서치를 시작할 지점 X Y 좌표 - 끝 지점 X Y 좌표, RGB값, 오차값, Fast(빠른) RGB(형식)		 if((ErrorLevel = 0))			{			load=1			timeRecord("","메인 메뉴 검출 성공")			}		else		{   sleep,500   i++   if(i>55)   {	Error_Screenshot("Mainscreen search error")   timeRecord("","메인메뉴 발견 오류. F3을 눌러 매크로를 끄고 재시작해주세요.")      if Error_Shutdown=1   {	if Game_Shutdown=1	{	WinActivate They Are Billions	   Game_shutdown()	   temp2:=current-1   timeRecord(temp2,"번 세이브 파일을 생성 시도하는 과정에서 메인 메뉴를 발견하지 못하여 설정값에 따라 게임을 종료합니다.") 	}	if System_shutdown=1	{	   System_shutdown()	   temp2:=current-1	   timeRecord(temp2,"번 세이브 파일을 생성 시도하는 과정에서 메인 메뉴를 발견하지 못하여 설정값에 따라 PC를 종료합니다.")	}	}	   msgbox,메인메뉴 발견 오류. F3을 눌러 매크로를 끄고 재시작해주세요.   }		}		}WinActivate They Are Billions   GuiControl,,A,시작   Gui,Submit,nohide	;GUI의 값을 받아옵니다.   timeRecord(current,"번 세이브 파일을 생성합니다.") 	WinActivate They Are Billions		MouseClick, Left, 1657, 469,1   sleep,100	WinActivate They Are Billions		MouseClick, Left, 1637, 538,1   sleep,100	WinActivate They Are Billions		Send {Backspace}	WinActivate They Are Billions		Send {Backspace}	WinActivate They Are Billions		Send {Backspace}	WinActivate They Are Billions		Send {Backspace}	firstnumber:=current//1000	temp:=Mod(current,1000)	secondnumber:=temp//100	temp:=Mod(current,100)	thirdnumber:=temp//10	fourthnumber:=Mod(current,10)	WinActivate They Are Billions		Send {%firstnumber%}	WinActivate They Are Billions		Send {%secondnumber%}	WinActivate They Are Billions		Send {%thirdnumber%}	WinActivate They Are Billions		Send {%fourthnumber%} 	WinActivate They Are Billions		MouseClick, Left, 1125, 681,1   sleep,300	WinActivate They Are Billions		MouseClick, Left, 1125, 681,1   sleep,350	WinActivate They Are Billions		MouseClick, Left, 1269, 924,1   sleep,9500   SetNumLockState , Off   	load=0	i=0	GuiControl,,A,로딩 대기	while load<1	{	WinActivate They Are Billions	;게임 시작 후 우하단 솔져 초상화 찾기	PixelSearch, ,, 1856, 810, 1878, 830, 0xE46C49, 10, Fast RGB	;픽셀 서치를 시작할 지점 X Y 좌표 - 끝 지점 X Y 좌표, RGB값, 오차값, Fast(빠른) RGB(형식)		 if((ErrorLevel = 0))			{	;게임 시작 후 우하단 솔져 초상화 우측의 숫자 찾기	PixelSearch, ,, 1888, 810, 1902, 830, 0xE3D572, 10, Fast RGB	;픽셀 서치를 시작할 지점 X Y 좌표 - 끝 지점 X Y 좌표, RGB값, 오차값, Fast(빠른) RGB(형식)		 if((ErrorLevel = 0))			{				load++	WinActivate They Are Billions				Send {Pgdn Down} ;축소용 페이지 다운 누르기				sleep,100	WinActivate They Are Billions				send {F4} ;격자맵				sleep,50	WinActivate They Are Billions				Send {Space} ;일시정지				sleep,50	WinActivate They Are Billions				Send {NumLock Down} ;넘락 누르기				sleep,50	WinActivate They Are Billions				Send {numpad7 Down} ;넘패드 7번 누르기				sleep,50	WinActivate They Are Billions				Send {NumLock Up} ;넘락 떼기				sleep,50	WinActivate They Are Billions				Send {Pgdn Up} ;페이지 다운 떼기				GuiControl,,A,시작 완료   timeRecord(current,"번 세이브 파일 생성완료.") 			}			else			{			sleep, 500   i++   if(i>50)   {	Error_Screenshot("In-game mainscreen search error")   timeRecord("","게임 진입 후 솔져 초상화 발견 오류. F3을 눌러 매크로를 끄고 재시작해주세요.")   if Error_Shutdown=1   {	if Game_Shutdown=1	{	WinActivate They Are Billions	   Game_shutdown()	   temp2:=current-1   timeRecord(temp2,"게임 진입 후 솔져 초상화 발견 오류. 설정값에 따라 게임을 종료합니다.") 	}	if System_shutdown=1	{	   System_shutdown()	   temp2:=current-1	   timeRecord(temp2,"게임 진입 후 솔져 초상화 발견 오류. 설정값에 따라 PC를 종료합니다.")	}   }   msgbox,게임 진입 후 솔져 초상화 발견 오류. F3을 눌러 매크로를 끄고 재시작해주세요.   }					}}	}   sleep,100   test:=current   WinActivate They Are Billions   Screenshot(test)   timeRecord(current,"번 세이브 파일 스크린샷 생성완료.")   sleep,1500   GuiControl,,A,게임 나가기	WinActivate They Are Billions   send {Esc}   sleep,200	WinActivate They Are Billions		MouseClick, Left, 1598, 610,1   timeRecord(current,"번 세이브 파일을 생성 및 저장 완료.")       current:=current+1      playtime := playtime + 1      GuiControl, , B, %playtime% 회   GuiControl,,A,게임 나가기 완료      sleep,9000}if Finish_Shutdown=1{	if Game_Shutdown=1	{	WinActivate They Are Billions	   Game_shutdown()	   temp2:=current-1   timeRecord(temp2,"번 세이브 파일을 생성 후 설정값에 따라 게임을 종료합니다.") 	}	if System_shutdown=1	{	   System_shutdown()	   temp2:=current-1	   timeRecord(temp2,"번 세이브 파일을 생성 후 설정값에 따라 PC를 종료합니다.")	}}}}return   ^F2::{GuiControlGet,keyCtrlF2,,Key_Ctrl_F2,if keyCtrlF2=1   {	   timeRecord("","F2 입력으로 매크로를 재시작합니다.")      Reload   }}returnF3::   {      timeRecord("","F3 입력으로 매크로를 종료합니다.")      매크로시작 := false      ExitApp   }return!F1::   {   				sleep,150				Send {NumLock Down} ;넘락 누르기				sleep,150				Send {numpad7 Down} ;넘패드 7번 누르기				sleep,150				Send {NumLock Up} ;넘락 떼기				timeRecord("","ALT+F1 입력으로 체력바를 고정시켰습니다.")   }return   Button종료:{				timeRecord("","버튼 클릭으로 매크로를 종료했습니다.")    매크로시작 := false    ExitApp}returnScreenshot(OutFile){   pToken := Gdip_Startup()   screen=0|0|%A_ScreenWidth%|%A_ScreenHeight%   pBitmap := Gdip_BitmapFromScreen(screen)      	firstnumber:=OutFile//1000	temp:=Mod(OutFile,1000)	secondnumber:=temp//100	temp:=Mod(OutFile,100)	thirdnumber:=temp//10	fourthnumber:=Mod(OutFile,10)	   location = %A_ScriptDir%\screenshot\%firstnumber%%secondnumber%%thirdnumber%%fourthnumber%.jpg   Gdip_SaveBitmapToFile(pBitmap, location, 95)   Gdip_DisposeImage(pBitmap)   Gdip_Shutdown(pToken)}Error_Screenshot(OutFile){   FormatTime, CurrentDateTime,, yyyy-MM-dd HH-mm-ss   pToken := Gdip_Startup()   screen=0|0|%A_ScreenWidth%|%A_ScreenHeight%   pBitmap := Gdip_BitmapFromScreen(screen)   location = %A_ScriptDir%\screenshot\%CurrentDateTime% %OutFile% screenshot.jpg   Gdip_SaveBitmapToFile(pBitmap, location, 100)   Gdip_DisposeImage(pBitmap)   Gdip_Shutdown(pToken)};F4::;{;current:=1	;firstnumber:=current//1000	;temp:=Mod(current,1000)	;secondnumber:=temp//100	;temp:=Mod(current,100)	;thirdnumber:=temp//10	;fourthnumber:=Mod(current,10)	;msgbox, %firstnumber%	;msgbox, %secondnumber%	;msgbox, %thirdnumber%	;msgbox, %fourthnumber%;}Game_shutdown(){   sleep,1000   send !{F4}}System_shutdown(){   sleep,1000   shutdown, 12}              timeRecord(number,sentence){   global log_dir   FileAppend, [%A_Mon%/%A_Mday% %A_Hour%:%A_Min%:%A_Sec%] %number%%sentence%`n, %log_dir%   ;메모장 log.txt에 월, 일, 시, 분, 초, 지정 문장 순으로 추가작성됨.}